<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Disney+ | All Movies</title>
  <link rel="stylesheet" href="../styles/test.css">
</head>
<body>
  <div class="page-header">
    <h1 class="page-title">Popular Movies</h1>
    <a href="index.html" id="back-btn">‚Üê Back to Home</a>
  </div>

  <div id="movie-list"></div>

  <div id="movie-details" class="hidden">
    <div class="movie-details-content">
      <div class="movie-poster">
        <img id="poster" alt="Movie Poster" />
      </div>
      <div class="movie-details-info">
        <h2 id="title"></h2>
        <div class="rating-badge">
          Rating: <span id="rating"></span>
        </div>
        <p id="overview"></p>
        <p><strong>Release Date:</strong> <span id="release-date"></span></p>
      </div>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const API_KEY = '72b544388cd4251b3736f3600c5dccc0';
      const BASE_URL = 'https://api.themoviedb.org/3';
      const IMAGE_BASE = 'https://image.tmdb.org/t/p/w500';
    
      const movieList = document.getElementById('movie-list');
      const detailsSection = document.getElementById('movie-details');
    
      async function fetchPopularMovies() {
        try {
          const response = await fetch(`${BASE_URL}/movie/popular?api_key=${API_KEY}`);      
          const data = await response.json();
          displayMovies(data.results);
        } catch (error) {
          console.error('Error fetching popular movies:', error);
          movieList.innerHTML = '<p style="color: #fff; text-align: center;">Error loading movies. Please try again later.</p>';
        }
      }
    
      function displayMovies(movies) {
        movieList.innerHTML = '';
        movies.forEach(movie => {
          const card = document.createElement('div');
          card.classList.add('movie-card');
          card.innerHTML = `
            <img src="${IMAGE_BASE + movie.poster_path}" alt="${movie.title}" />
            <div class="movie-info">
              <h3>${movie.title}</h3>
              <p>${movie.overview.slice(0, 80)}...</p>
              <div class="rating-badge">Rating: ${movie.vote_average}</div>
            </div>
          `;
          card.addEventListener('click', () => fetchMovieDetails(movie.id));
          movieList.appendChild(card);
        });
      }
    
      async function fetchMovieDetails(movieId) {
        try {
          const response = await fetch(`${BASE_URL}/movie/${movieId}?api_key=${API_KEY}`);
          const movie = await response.json();
          showDetails(movie);
        } catch (error) {
          console.error('Error fetching movie details:', error);
        }
      }
    
      function showDetails(movie) {
        document.getElementById('title').innerText = movie.title;
        document.getElementById('poster').src = IMAGE_BASE + movie.poster_path;
        document.getElementById('poster').alt = movie.title;
        document.getElementById('overview').innerText = movie.overview;
        document.getElementById('rating').innerText = movie.vote_average;
        document.getElementById('release-date').innerText = new Date(movie.release_date).toLocaleDateString();
        
        detailsSection.classList.remove('hidden');
        
        // Close on click outside
        const closeOnClickOutside = (e) => {
          if (!e.target.closest('.movie-details-content')) {
            detailsSection.classList.add('hidden');
            document.removeEventListener('click', closeOnClickOutside);
          }
        };
        
        setTimeout(() => {
          document.addEventListener('click', closeOnClickOutside);
        }, 100);
      }
    
      fetchPopularMovies();
    });
  </script>
</body>
</html>